(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{122:function(e,t,n){},124:function(e,t,n){},126:function(e,t,n){},180:function(e,t){},206:function(e,t){},310:function(e,t,n){},312:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),r=n(85),i=n.n(r),o=n(94),u=n(95),c=n(6),l=n.n(c),p=n(20),m=n(86),d=n(87),g=n(96),b=n(88),f=n(97),h=n(15),y=n(89),v=n.n(y),w=n(33),M=(n(122),function(e){var t=e.message,n=t.message,a=t.owner,r=t.timestamp,i=t.tips,o=e.messageID,u=e.featured,c=e.tippable,l=e.requiresTronLink,p=e.onTip;return s.a.createElement("div",{className:"message-wrapper"},s.a.createElement("div",{className:"message"+(c?" tippable":"")+(l?" requiresTronLink":""),onClick:function(){return p(o)}},s.a.createElement("div",{className:"header"},s.a.createElement("div",{className:"owner"},a),u&&s.a.createElement("div",{className:"star"},"\u2605")),s.a.createElement(w.Scrollbars,{style:{width:330,height:85,marginBottom:6},autoHide:!0},s.a.createElement("div",{className:"body"},n)),s.a.createElement("div",{className:"footer"},s.a.createElement("div",{className:"timestamp"},v()(1e3*r).fromNow()),i.count?s.a.createElement("div",{className:"tips"},s.a.createElement("strong",null,(i.amount/1e6).toLocaleString()," TRX")," from ",i.count.toLocaleString()," tip",1===i.count?"":"s"):"")))}),E=(n(124),function(e){var t=e.recent,n=e.featured,a=e.currentAddress,r=e.tronLinkInstalled,i=e.onTip,o=n.sort(function(e,n){return t[n].tips.amount-t[e].tips.amount}).map(function(e){return s.a.createElement(M,{message:t[e],featured:!0,key:e,messageID:e,tippable:t[e].owner!==a,requiresTronLink:!r,onTip:i})});return s.a.createElement("div",{className:"featured"},s.a.createElement(w.Scrollbars,{style:{height:220,width:"100%"},autoHide:!0},s.a.createElement("div",{className:"scrollable"},o)))}),k=n(90),T=n.n(k),W=(n(126),"https://chrome.google.com/webstore/detail/ibnejdfjmmkpcnlpebklmnkoeoihofec/"),x=s.a.createElement("div",{className:"logo"},s.a.createElement("img",{src:T.a,alt:"TronLink logo"})),N=function(){window.open(W,"_blank")},O=function(e){var t=e.installed;return void 0!==t&&t?s.a.createElement("div",{className:"tronLink hover",onClick:N},s.a.createElement("div",{className:"info"},s.a.createElement("h1",null,"Log in Required"),s.a.createElement("p",null,"TronLink is installed but you must first log in. Open TronLink from the browser bar and set up your first wallet or decrypt a previously-created wallet.")),x):s.a.createElement("div",{className:"tronLink",onClick:N},s.a.createElement("div",{className:"info"},s.a.createElement("h1",null,"TronLink Required"),s.a.createElement("p",null,"To create a post or tip others you must install TronLink. TronLink is a TRON wallet for the browser that can be ",s.a.createElement("a",{href:W,target:"_blank",rel:"noopener noreferrer"},"installed from the Chrome Webstore"),". Once installed, return back and refresh the page.")),x)},j=n(91),L=n.n(j),I=n(34),S=n(92)["TRXMessages.sol:TRXMessages"],P={tronWeb:!1,contract:!1,setTronWeb:function(e){this.tronWeb=e,this.contract=e.contract(S.abi,S.address)},transformMessage:function(e){return{tips:{amount:e.tips,count:e.tippers.toNumber()},owner:this.tronWeb.address.fromHex(e.creator),timestamp:e.time.toNumber(),message:e.message}},fetchMessages:function(){var e=Object(p.a)(l.a.mark(function e(){var t,n,a,s,r,i,o,u=this,c=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=c.length>0&&void 0!==c[0]?c[0]:{},n=c.length>1&&void 0!==c[1]?c[1]:[],a=0;case 3:if(!(a<20)){e.next=13;break}return e.next=6,this.contract.topPosts(a).call();case 6:if(0!==(s=e.sent).toNumber()){e.next=9;break}return e.abrupt("break",13);case 9:n.push(s.toNumber());case 10:a++,e.next=3;break;case 13:return e.next=15,this.contract.current().call();case 15:return r=e.sent.toNumber(),i=Math.max(1,r-30),o=Object(I.a)(new Set(Object(I.a)(new Array(r-i).fill().map(function(e,t){return i+t})).concat(Object(I.a)(n)))),e.next=20,Promise.all(o.map(function(e){return u.contract.messages(e).call()})).then(function(e){return e.forEach(function(e,n){var a=+o[n];t[a]=u.transformMessage(e)})});case 20:return e.abrupt("return",{featured:n,recent:t});case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fetchMessage:function(){var e=Object(p.a)(l.a.mark(function e(t,n){var a,s,r,i,o,u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.recent,s=void 0===a?{}:a,r=n.featured,i=void 0===r?[]:r,e.next=3,this.contract.messages(t).call();case 3:return o=e.sent,u=Object.keys(s).filter(function(e){return!i.includes(e)}).sort(function(e,t){return s[t].timestamp-s[e].timestamp}),s[t]=this.transformMessage(o),u.length>30&&u.splice(0,u.length-30).forEach(function(e){delete s[e]}),e.abrupt("return",{message:s[t],recent:s,featured:i});case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},C=n(16),R=n.n(C),_=n(93),A=n.n(_),D=(n(310),function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(g.a)(this,Object(b.a)(t).call(this,e))).state={tronWeb:{installed:!1,loggedIn:!1},currentMessage:{message:"",loading:!1},messages:{recent:{},featured:[]}},n.onMessageEdit=n.onMessageEdit.bind(Object(h.a)(Object(h.a)(n))),n.onMessageSend=n.onMessageSend.bind(Object(h.a)(Object(h.a)(n))),n.onMessageTip=n.onMessageTip.bind(Object(h.a)(Object(h.a)(n))),n}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e){var n={installed:!!window.tronWeb,loggedIn:window.tronWeb&&window.tronWeb.ready};if(n.installed)return t.setState({tronWeb:n}),e();var a=0,s=setInterval(function(){if(a>=10){return window.tronWeb=new L.a("https://api.trongrid.io","https://api.trongrid.io","https://api.trongrid.io"),t.setState({tronWeb:{installed:!1,loggedIn:!1}}),clearInterval(s),e()}if(n.installed=!!window.tronWeb,n.loggedIn=window.tronWeb&&window.tronWeb.ready,!n.installed)return a++;t.setState({tronWeb:n}),e()},100)});case 2:this.state.tronWeb.loggedIn||(window.tronWeb.defaultAddress={hex:window.tronWeb.address.toHex("TWiWt5SEDzaEqS6kE5gandWMNfxR2B5xzg"),base58:"TWiWt5SEDzaEqS6kE5gandWMNfxR2B5xzg"},window.tronWeb.on("addressChanged",function(){t.state.tronWeb.loggedIn||t.setState({tronWeb:{installed:!0,loggedIn:!0}})})),P.setTronWeb(window.tronWeb),this.startEventListener(),this.fetchMessages();case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"startEventListener",value:function(){var e=this;P.contract.MessagePosted().watch(function(t,n){var a=n.result;if(t)return console.error("Failed to bind event listener:",t);console.log("Detected new message:",a.id),e.fetchMessage(+a.id)})}},{key:"fetchMessages",value:function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P.fetchMessages();case 3:e.t1=e.sent,e.t2={messages:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchMessage",value:function(){var e=Object(p.a)(l.a.mark(function e(t){var n,a,s,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.fetchMessage(t,this.state.messages);case 2:return n=e.sent,a=n.recent,s=n.featured,r=n.message,this.setState({messages:{recent:a,featured:s}}),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onMessageEdit",value:function(e){var t=e.target.value;this.state.currentMessage.loading||this.setState({currentMessage:{message:t,loading:!1}})}},{key:"onMessageSend",value:function(){var e=this,t=this.state.currentMessage,n=t.loading,a=t.message;n||a.trim().length&&(this.setState({currentMessage:{loading:!0,message:a}}),P.contract.postMessage(a).send({shouldPollResponse:!0,callValue:0}).then(function(e){return R()({title:"Post Created",type:"success"})}).catch(function(e){return R()({title:"Post Failed",type:"error"})}).then(function(){e.setState({currentMessage:{loading:!1,message:a}})}))}},{key:"onMessageTip",value:function(){var e=Object(p.a)(l.a.mark(function e(t){var n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Object(u.a)({},this.state.messages.recent,this.state.messages.featured)).hasOwnProperty(t)){e.next=3;break}return e.abrupt("return");case 3:if(this.state.tronWeb.loggedIn){e.next=5;break}return e.abrupt("return");case 5:if(n[t].owner!==P.tronWeb.defaultAddress.base58){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,R()({title:"Tip Message",text:"Enter tip amount in TRX",confirmButtonText:"Tip",input:"text",showCancelButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,allowOutsideClick:function(){return!R.a.isLoading()},allowEscapeKey:function(){return!R.a.isLoading()},preConfirm:function(e){return isNaN(e)||e<=0?(R.a.showValidationMessage("Invalid tip amount provided"),!1):P.contract.tipMessage(+t).send({callValue:1e6*Number(e)}).then(function(){return!0}).catch(function(e){R.a.showValidationMessage(e)})}});case 9:a=e.sent,a.value&&R()({title:"Message Tipped",type:"success"});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderMessageInput",value:function(){return this.state.tronWeb.installed?this.state.tronWeb.loggedIn?s.a.createElement("div",{className:"messageInput"+(this.state.currentMessage.loading?" loading":"")},s.a.createElement("textarea",{placeholder:"Enter your message to post",value:this.state.currentMessage.message,onChange:this.onMessageEdit}),s.a.createElement("div",{className:"footer"},s.a.createElement("div",{className:"warning"},"Posting a message will cost 1 TRX and network fees"),s.a.createElement("div",{className:"sendButton"+(this.state.currentMessage.message.trim().length?"":" disabled"),onClick:this.onMessageSend},"Post Message"))):s.a.createElement(O,{installed:!0}):s.a.createElement(O,null)}},{key:"render",value:function(){var e=this,t=this.state.messages,n=t.recent,a=t.featured,r=Object.entries(n).sort(function(e,t){return t[1].timestamp-e[1].timestamp}).map(function(t){var n=Object(o.a)(t,2),r=n[0],i=n[1];return s.a.createElement(M,{message:i,featured:a.includes(+r),key:r,messageID:r,tippable:i.owner!==P.tronWeb.defaultAddress.base58,requiresTronLink:!e.state.tronWeb.installed,onTip:e.onMessageTip})});return s.a.createElement("div",{className:"kontainer"},s.a.createElement("div",{className:"header white"},s.a.createElement("a",{href:"https://tronwatch.market",target:"_blank",rel:"noopener noreferrer"},s.a.createElement("img",{className:"banner",src:A.a,alt:"TronWatch Market ICO"})),s.a.createElement("p",null,s.a.createElement("strong",null,"Tron Message Board")," is a DApp which allows you to post messages along with tipping others or receiving tips. There is no additional cost associated when tipping people, however you do have to pay network fees.",s.a.createElement("br",null),s.a.createElement("br",null),"Want to build your own DApp? The code to this demo is available on\xa0",s.a.createElement("a",{href:"https://github.com/TronWatch/TronLink-Demo-Messages/",target:"_blank",rel:"noopener noreferrer"},"GitHub"),".")),this.renderMessageInput(),s.a.createElement("div",{className:"header"},s.a.createElement("h1",null,"Featured"),s.a.createElement("span",null,"The top 20 messages, sorted by the total tips")),s.a.createElement(E,{recent:n,featured:a,currentAddress:P.tronWeb&&P.tronWeb.defaultAddress.base58,tronLinkInstalled:this.state.tronWeb.installed,onTip:this.onMessageTip}),s.a.createElement("div",{className:"header"},s.a.createElement("h1",null,"Recent"),s.a.createElement("span",null,"Click any message to send the user a tip")),s.a.createElement("div",{className:"messages"},r))}}]),t}(s.a.Component));i.a.render(s.a.createElement(D,null),document.getElementById("root"))},90:function(e,t,n){e.exports=n.p+"static/media/TronLinkLogo.d3a8f115.png"},92:function(e){e.exports={"Migrations.sol:Migrations":{address:"414587f71ee0a12665ae6e883c1e4c20be38fc3b83",abi:[{constant:!1,inputs:[{name:"new_address",type:"address"}],name:"upgrade",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"last_completed_migration",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"completed",type:"uint256"}],name:"setCompleted",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}]},"TRXMessages.sol:TRXMessages":{address:"41a4997124a328a4615eab437cede31da47a31b375",abi:[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"messages",outputs:[{name:"creator",type:"address"},{name:"message",type:"string"},{name:"tips",type:"uint256"},{name:"tippers",type:"uint256"},{name:"time",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_feeToPost",type:"uint256"}],name:"updateFeeToPost",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"feeToPost",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"minimumTip",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_id",type:"uint256"}],name:"tipMessage",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"_minimumTip",type:"uint256"}],name:"updateMinimumTip",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"message",type:"string"}],name:"postMessage",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"current",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_owner",type:"address"}],name:"changeOwner",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"topPosts",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"id",type:"uint256"}],name:"MessagePosted",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"id",type:"uint256"}],name:"MessageTipped",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"id",type:"uint256"}],name:"MessageAddedToTopPosts",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"id",type:"uint256"}],name:"MessageRemovedFromTopPosts",type:"event"}]}}},93:function(e,t,n){e.exports=n.p+"static/media/banner.4c3553e3.png"},98:function(e,t,n){e.exports=n(312)}},[[98,2,1]]]);
//# sourceMappingURL=main.9b4f3d9c.chunk.js.map